
<head>

<html xmlns:th="http://www.thymeleaf.org"xmlns:sec="http://www.thymeleaf.org/extras/spring-security">


<link
  href="https://getbootstrap.com/docs/5.3/dist/css/bootstrap.min.css"
  rel="stylesheet"
  integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
  crossorigin="anonymous">
<script
  src="https://getbootstrap.com/docs/5.3/dist/js/bootstrap.bundle.min.js"
  integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
  crossorigin="anonymous"></script>
<link
  href="https://getbootstrap.com/docs/5.3/examples/sidebars/sidebars.css"
  rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/bxslider/4.2.15/jquery.bxslider.min.css" rel="stylesheet" />
<script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bxslider/4.2.15/jquery.bxslider.min.js"></script>
<link rel="stylesheet" href="css/style.css">

<!-- 부트스트랩 CSS 링크 -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap-datepicker@1.9.0/dist/js/bootstrap-datepicker.min.js"></script>
<link href="https://cdn.jsdelivr.net/npm/bootstrap-datepicker@1.9.0/dist/css/bootstrap-datepicker.min.css" rel="stylesheet">
<!-- Bootstrap Icons CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">

<title>기사 관리</title>

<!-- 그래프 -->
 <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
    #datePickerButton {
        background-color: #3F7EFC;
        border-color: #3F7EFC; /* 선택적으로 테두리 색상을 지정할 수 있습니다. */
    }
    
    .circle {
    width: 20px;
    height: 20px;
    border-radius: 50%;
    display: inline-block;
    margin-right: 5px;
  }

  .green { background-color: green; }
  .orange { background-color: orange; }
  .red { background-color: red; }
  
      body {
        margin: 0;
        padding: 0;
    }
    .background-image {
        position: fixed; /* 이미지를 고정된 위치에 배치 */
        top: 100px;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: -9999; /* 다른 요소들 보다 뒤로 */
        opacity: 0.4; /* 투명도 설정 */
    }
  
 #myChart {
    margin-left : 15px;
    margin-top : 30px;
    width: 1500px !important;
    height: 720px !important;
}
</style>
 <th:block th:insert="~{fragments :: header}" style = "z-index : 9999"/>

</head>
<body>
    <!-- 템플릿 본문 내용 -->
 

    <main class="d-flex flex-nowrap" style= "z-index: 9999">
   <!--  <img class="background-image" src="images/adminBackground.PNG" alt="배경 이미지">  --> 
        <div class="d-flex flex-column align-items-stretch flex-shrink-0 bg-body-tertiary border border-r-1" style="width: 380px; margin-top: 10px;">
            <div class="d-flex align-items-center flex-shrink-0 p-3 link-body-emphasis text-decoration-none">
                <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="#4ae39c" viewBox="0 0 256 256" class="me-2">
                    <path d="M232,128A104,104,0,1,1,128,24,104.13,104.13,0,0,1,232,128Z" fill="#3F7EFC"></path>
                </svg>
                <span class="fs-5 fw-semibold">기 사 목 록</span>
            </div>
            <div class="d-flex flex-wrap py-3 px-2 gap-3 align-items-center justify-content-center border-bottom">
                <div class="border-start border-2 h-50"></div>
                <div class="d-flex flex-column align-items-center">
                    <span class="fs-5 fw-semibold">지역 선택 : </span>
                </div>
                <div class="d-flex flex-column align-items-center">
                    <select id="local" name="local">
                        <option value="">선택하세요</option>
                        <option value="서구">서구</option>
                        <option value="동구">동구</option>
                        <option value="계양구">계양구</option>
                        <option value="부평구">부평구</option>
                        <option value="남동구">남동구</option>
                        <option value="미추홀구">미추홀구</option>
                        <option value="연수구">연수구</option>
                    </select>
                </div>
               
    
                <div class="border-start border-2 h-50"></div>
                             <div class="d-flex flex-column align-items-center">
                             
                    <span class="fs-5 fw-semibold">날짜 선택 : </span>
                </div>
                <div class="d-flex flex-column align-items-center" >
                   <button type="button" class="btn btn-secondary p-0" id="datePickerButton" >
        <i class="bi bi-calendar"></i>
        </button>

    
                </div>
        <span id="DATE-TIME"> </span>
            </div>
            <div style="display: flex; justify-content: center; align-items: center; background-color: #3F7EFC;">
                <span class="fs-5 fw-semibold" style="margin-top: 5%; margin-bottom: 5%; color: #ffffff; ">PickUp Man List</span>
            </div>

            <!-- 드라이버 목록을 출력할 위치 -->
            <div class="list-group scrollarea px-3 flex-grow-1" >
                <div id="driverList" class="abc">
                    
                </div>
            </div>
            
            <!--  -->
        </div>
        <div style="width: 100%; height: 100%;"> 


     <div id="driverInfoList123" style="margin-left: 3%;">
        <!-- 여기에 운행 리스트가 나타날 것입니다. -->
    </div>

			<canvas id="myChart"></canvas>
    </div>
    
			
    </main>    
</body>
<script th:inline="javascript">
  
    window.onload = function() {
        // 부트스트랩 달력 초기화
        $('#datePickerButton').datepicker({
            format: 'yyyy-mm-dd',
            autoclose: true,
            todayHighlight: true
        }).on('changeDate', function(e) {
            const selectedDate = formatDate(e.date); // formatDate 함수를 사용하여 날짜 형식 조정
            document.getElementById('DATE-TIME').innerText = selectedDate;
        });

        // 오늘 날짜 표시
        var today = new Date();
        var year = today.getFullYear();
        var month = (today.getMonth() + 1).toString().padStart(2, '0'); // 한 자릿수일 때 앞에 0을 붙임
        var day = today.getDate().toString().padStart(2, '0'); // 한 자릿수일 때 앞에 0을 붙임
        var dateString = year + '-' + month + '-' + day;
        document.getElementById('DATE-TIME').innerText = dateString;
    };
    
 // 주어진 날짜 객체를 yyyy-mm-dd 형식의 문자열로 변환하는 함수
    function formatDate(date) {
        const year = date.getFullYear();
        const month = (date.getMonth() + 1).toString().padStart(2, '0');
        const day = date.getDate().toString().padStart(2, '0');
        return `${year}-${month}-${day}`;
    }
    
    
    

    
        $(document).ready(function() {
            $('#local').change(function() {
                var selectedValue = $(this).val(); // 선택된 옵션의 값
                console.log("selectedValue =", selectedValue);
                // AJAX 요청
                $.ajax({
                    url: 'selectedLocal', // 컨트롤러의 URL
                    method: 'POST',
                    data: {
                        selectedValue: selectedValue
                    }, // 선택된 값 전송
                    success: function(response) {
                        // 성공적으로 서버로부터 응답을 받았을 때 수행할 작업
                        console.log('AJAX 요청이 성공적으로 전송되었습니다.');
                        console.log('응답 데이터:', response);
                        // 드라이버 목록 업데이트
                        updateDriverList(response);
                       
                    },
                    error: function(xhr, status, error) {
                        // Ajax 요청이 실패했을 때 수행할 작업
                        console.error('AJAX 요청이 실패하였습니다:', error);
                    }
                });
            });
        });

        // 드라이버 목록을 업데이트하는 함수
        function updateDriverList(driverData) {
            // 드라이버 목록을 초기화
            $('#driverList').empty();

            // 각 드라이버에 대한 정보를 출력
            driverData.forEach(function(driver) {
                var driverItem = $('<a href="#" class="list-group-item list-group-item-action py-3 lh-sm mt-3 border rounded-2"></a>');
                driverItem.append('<div class="d-flex w-100 align-items-center justify-content-start mb-1"></div>');
                driverItem.append('<div class="ma-1"></div>');
                driverItem.append('<div class="ma-2"></div>');
                driverItem.find('.d-flex').append('<span type="text"> 이름 : '+ driver.m_NAME +'</span>');
                driverItem.find('.d-flex').append('<input type="hidden" id="dr_ID" value="'+driver.dr_ID+'">');
                console.log("driver.dr_ID = ", driver.dr_ID);
                driverItem.find('.ma-1').append('<span type="text"> 운행구역 : '+ driver.dr_AREA +'</span>');
                driverItem.find('.ma-2').append('<span type="text"> 차량번호 : '+ driver.dr_CARNUM +'</span>');
                
                // 링크를 클릭했을 때 이벤트 처리
                // 클릭 이벤트 핸들러를 설정하는 코드
                $('#driverList').append(driverItem);
            });
    $(document).on('click', '#driverList a', function(event) {
        event.preventDefault(); // 기본 동작 방지
        var driverID = parseInt($(this).find('#dr_ID').val()); // 드라이버 ID 가져오기
        console.log("Clicked driver ID:", driverID);
        
        // 선택된 드라이버의 정보를 가져와서 화면에 출력
        var selectedDriver = driverData.find(function(driver) {
            return parseInt(driver.dr_ID) === parseInt(driverID);
        });
        if (selectedDriver) {
            displayDriverInfo(selectedDriver);
            
   
        }else {
            console.error('error');
        }
     // 드라이버 정보를 화면에 출력하는 함수
        function displayDriverInfo(driverInfo) {
            $('#driverName').text('이름 : ' + driverInfo.m_NAME);
            $('#driverPhone').text('전화번호 : ' + driverInfo.m_PHONE);
         
            $('#driverLocal').text('주 운행지 : ' + driverInfo.dr_AREA);
            $('#driverCarnum').text('차량 번호 : ' + driverInfo.dr_CARNUM);
            $('#driverId').text(driverInfo.dr_ID);
        }
     //2024-04-29 진행중-------------------------------------------------------------------------
     
    var driverID = parseInt($(this).find('#dr_ID').val());
//     var GetDriverList = [[${GetDriverList}]];



      $.ajax({
                    url: 'adminDRMTproc', // 컨트롤러의 URL
                    method: 'POST',
                    data: {
                        DR_ID: driverID
                    }, // 선택된 값 전송
                    success: function(response) {
                        // 성공적으로 서버로부터 응답을 받았을 때 수행할 작업
                        console.log('AJAX 요청이 성공적으로 전송되었습니다.');
                        console.log('응답 데이터:', response);
                        // 드라이버 목록 업데이트
                       
                       
                    },
                    error: function(xhr, status, error) {
                        // Ajax 요청이 실패했을 때 수행할 작업
                        console.error('AJAX 요청이 실패하였습니다:', error);
                    }
                });

    // 출근 시간 데이터 생성
    function generateArrivalData() {
        const currentDate = new Date();
        const arrivalData = [];

        // 오늘 날짜 기준으로 -14일까지의 출근 시간 데이터 생성
        for (let i = 14; i >= 0; i--) {
            const date = new Date(currentDate);
            date.setDate(date.getDate() - i); // i일 전의 날짜로 설정
            
            
            const hours = Math.floor(Math.random() * 3) + 7; // 7 ~ 9 사이의 임의의 시간 (정수)
            const minutes = Math.floor(Math.random() * 60); // 0 ~ 59 사이의 임의의 분
            const time = hours + minutes / 60; // 시간을 소수점으로 표현 (예: 8시 27분 => 8.45)

            arrivalData.push(time);
        }

        return arrivalData;
    }

    // 퇴근 시간 데이터 생성
    function generateDepartureData() {
        const currentDate = new Date();
        const departureData = [];

        // 오늘 날짜 기준으로 -14일까지의 퇴근 시간 데이터 생성
        for (let i = 14; i >= 0; i--) {
            const date = new Date(currentDate);
            date.setDate(date.getDate() - i); // i일 전의 날짜로 설정
            const hours = Math.floor(Math.random() * 3) + 17; // 17 ~ 19 사이의 임의의 시간 (정수)
            const minutes = Math.floor(Math.random() * 60); // 0 ~ 59 사이의 임의의 분
            const time = hours + minutes / 60; // 시간을 소수점으로 표현 (예: 8시 27분 => 8.45)

            departureData.push(time);
        }

        return departureData;
    }

    // 출근 시간 데이터 생성
    const arrivalData = generateArrivalData();

    // 퇴근 시간 데이터 생성
    const departureData = generateDepartureData();

    // 날짜 라벨 생성
    const currentDate = new Date();
    const labels = [];
    for (let i = 14; i >= 0; i--) {
        const date = new Date(currentDate);
        date.setDate(date.getDate() - i); // i일 전의 날짜로 설정
        labels.push(`${date.getMonth() + 1}/${date.getDate()}`);
    }

 

    const chartData = {
        labels: labels,
        datasets: [
            {
                label: '출근 시간',
                data: arrivalData,
                borderColor: 'rgb(75, 192, 192)',
                tension: 0.1
            },
            {
                label: '퇴근 시간',
                data: departureData,
                borderColor: 'rgb(255, 159, 64)',
                tension: 0.1
            }
        ]
    };

    const options = {
        scales: {
            y: {
                beginAtZero: true,
                title: {
                    display: true,
                    text: '시간',
                    fontSize: 16,
                    fontWeight: 'bold'
                },
                min: 6,
                max: 20,
                stepSize: 1,
                ticks: {
                    fontSize: 14,
                    fontWeight: 'bold'
                }
            },
            x: {
                title: {
                    display: true,
                    text: '날짜',
                    fontSize: 16,
                    fontWeight: 'bold'
                },
                ticks: {
                    fontSize: 14,
                    fontWeight: 'bold'
                }
            }
        }
    };

    // 캔버스 요소 가져오기
    const canvas = document.getElementById('myChart');

    // 캔버스 컨텍스트 가져오기
    const ctx = canvas.getContext('2d');

    // 선 그래프 생성
    const myChart = new Chart(ctx, {
        type: 'line',
        data: chartData,
        options: options
    });
    
     
    });
    
    
 }

    
        
        
  
    </script>
   
    
  

</html>