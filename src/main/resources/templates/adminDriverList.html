<html xmlns:th="http://www.thymeleaf.org">

<link
  href="https://getbootstrap.com/docs/5.3/dist/css/bootstrap.min.css"
  rel="stylesheet"
  integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
  crossorigin="anonymous">
<script
  src="https://getbootstrap.com/docs/5.3/dist/js/bootstrap.bundle.min.js"
  integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
  crossorigin="anonymous"></script>
<link
  href="https://getbootstrap.com/docs/5.3/examples/sidebars/sidebars.css"
  rel="stylesheet">
<script src="https://code.jquery.com/jquery-3.7.1.min.js"
  integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo="
  crossorigin="anonymous"></script>
  <script src="js/jquery-3.7.1.min.js"></script>
<link rel="stylesheet" href="css/style.css">

<!-- 부트스트랩 CSS 링크 -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap-datepicker@1.9.0/dist/js/bootstrap-datepicker.min.js"></script>
<link href="https://cdn.jsdelivr.net/npm/bootstrap-datepicker@1.9.0/dist/css/bootstrap-datepicker.min.css" rel="stylesheet">
<!-- Bootstrap Icons CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">

<head>
<style>
    #datePickerButton {
        background-color: #3F7EFC;
        border-color: #3F7EFC; /* 선택적으로 테두리 색상을 지정할 수 있습니다. */
    }
    
    .circle {
    width: 20px;
    height: 20px;
    border-radius: 50%;
    display: inline-block;
    margin-right: 5px;
  }

  .green { background-color: green; }
  .orange { background-color: orange; }
  .red { background-color: red; }
</style>
 <th:block th:insert="~{fragments :: header}" />

</head>
<body>
    <!-- 템플릿 본문 내용 -->
    <main class="d-flex flex-nowrap">
        <div class="d-flex flex-column align-items-stretch flex-shrink-0 bg-body-tertiary border border-r-1" style="width: 380px;">
            <div class="d-flex align-items-center flex-shrink-0 p-3 link-body-emphasis text-decoration-none">
                <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="#4ae39c" viewBox="0 0 256 256" class="me-2">
                    <path d="M232,128A104,104,0,1,1,128,24,104.13,104.13,0,0,1,232,128Z" fill="#3F7EFC"></path>
                </svg>
                <span class="fs-5 fw-semibold">기 사 목 록</span>
            </div>
            <div class="d-flex flex-wrap py-3 px-2 gap-3 align-items-center justify-content-center border-bottom">
                <div class="border-start border-2 h-50"></div>
                <div class="d-flex flex-column align-items-center">
                    <span class="fs-5 fw-semibold">지역 선택 : </span>
                </div>
                <div class="d-flex flex-column align-items-center">
                    <select id="local" name="local">
                        <option value="">선택하세요</option>
                        <option value="서구">서구</option>
                        <option value="동구">동구</option>
                        <option value="계양구">계양구</option>
                        <option value="부평구">부평구</option>
                        <option value="남동구">남동구</option>
                        <option value="미추홀구">미추홀구</option>
                        <option value="연수구">연수구</option>
                    </select>
                </div>
                <div class="border-start border-2 h-50"></div>
            </div>
            <div style="display: flex; justify-content: center; align-items: center; background-color: #3F7EFC;">
                <span class="fs-5 fw-semibold" style="margin-top: 5%; margin-bottom: 5%; color: #4D4D4D;">PickUp Man List</span>
            </div>

            <!-- 드라이버 목록을 출력할 위치 -->
            <div class="list-group scrollarea px-3 flex-grow-1" >
                <div id="driverList" class="abc">
                    
                </div>
            </div>
            
            <!--  -->
        </div>
        <div style="width: 100%; height: 100%;"> 
       <div style="display: flex; align-items: flex-start; margin-top: 3%; margin-left: 3%; width: 100%; height: 50%;" >
    <img src="images/nullprofile.png" style="width: 300px; height: auto;">
    <div style="margin-left: 3%;"> <!-- 여백 조정 -->
      
            <ul style="font-weight: bold; font-size: 25px;">
                <li id="driverName">이름 : </li>
                <br>
                <li id="driverPhone">전화번호  : </li>
                <br>
                <li id="driverAdrees">주 소 : </li>
                <br>
                <li id="driverLocal">주 운행지 : </li>
                <br>
                <li id="driverCarnum">차량 번호 : </li>
                <br>
                <li style="display:none;" id="driverId"></li>
            </ul>
          
          
    </div>
</div>
    <div>
      <h2>운행 리스트</h2>
      <table border="1" id="myTable">
      <tr>
       <td></td>
       <td>배차 선정일</td>
       <td>선정 시간</td>
       <td>배차 상태</td>
      </tr>
      
      </table>
      
    </div>
    </div>
    </main>

    <script th:inline="javascript">
    
    $(document).on('click', '.orange', function(event){
        var drIDValue = $("#driverId").text();
        console.log("drIDValue = ", drIDValue);
        $.ajax({
            type: "GET", // 또는 "GET"
            url: "/nodeSelection", // 컨트롤러의 URL을 여기에 입력하세요.
            data: { drID: drIDValue }, // dr_ID1의 값을 drID라는 이름으로 전달합니다.
            success: function(response){
                // 성공적으로 요청이 완료되었을 때 실행할 코드를 여기에 작성하세요.
                console.log(drIDValue);
               if(drIDValue == ""){
            	   alert("기사 선택을 먼저 해주세요");
               }else{
            	   window.location.href = "nodeSelection";   
               }
               
              
                
            },
            error: function(xhr, status, error){
                // 요청이 실패했을 때 실행할 코드를 여기에 작성하세요.
                console.error(xhr.responseText); // 오류 메시지를 콘솔에 출력하거나 다른 작업을 수행합니다.
            }
        });
    });
    
    
    
        $(document).ready(function() {
            $('#local').change(function() {
                var selectedValue = $(this).val(); // 선택된 옵션의 값
                console.log("selectedValue =", selectedValue);
                // AJAX 요청
                $.ajax({
                    url: 'selectedLocal', // 컨트롤러의 URL
                    method: 'POST',
                    data: {
                        selectedValue: selectedValue
                    }, // 선택된 값 전송
                    success: function(response) {
                        // 성공적으로 서버로부터 응답을 받았을 때 수행할 작업
                        console.log('AJAX 요청이 성공적으로 전송되었습니다.');
                        console.log('응답 데이터:', response);

                        // 드라이버 목록 업데이트
                        updateDriverList(response);
                    },
                    error: function(xhr, status, error) {
                        // Ajax 요청이 실패했을 때 수행할 작업
                        console.error('AJAX 요청이 실패하였습니다:', error);
                    }
                });
            });
        });

        // 드라이버 목록을 업데이트하는 함수
        function updateDriverList(driverData) {
            // 드라이버 목록을 초기화
            $('#driverList').empty();

            // 각 드라이버에 대한 정보를 출력
            driverData.forEach(function(driver) {
                var driverItem = $('<a href="#" class="list-group-item list-group-item-action py-3 lh-sm mt-3 border rounded-2"></a>');
                driverItem.append('<div class="d-flex w-100 align-items-center justify-content-start mb-1"></div>');
                driverItem.append('<div class="ma-1"></div>');
                driverItem.append('<div class="ma-2"></div>');
                driverItem.find('.d-flex').append('<span type="text"> 이름 : '+ driver.m_NAME +'</span>');
                driverItem.find('.d-flex').append('<input type="hidden" id="dr_ID" value="'+driver.dr_ID+'">');
                console.log("driver.dr_ID = ", driver.dr_ID);
                driverItem.find('.ma-1').append('<span type="text"> 운행구역 : '+ driver.dr_AREA +'</span>');
                driverItem.find('.ma-2').append('<span type="text"> 차량번호 : '+ driver.dr_CARNUM +'</span>');
                
                // 링크를 클릭했을 때 이벤트 처리
                // 클릭 이벤트 핸들러를 설정하는 코드
                $('#driverList').append(driverItem);
            });
    $(document).on('click', '#driverList a', function(event) {
        event.preventDefault(); // 기본 동작 방지
        var driverID = parseInt($(this).find('#dr_ID').val()); // 드라이버 ID 가져오기
        console.log("Clicked driver ID:", driverID);
        
        // 선택된 드라이버의 정보를 가져와서 화면에 출력
        var selectedDriver = driverData.find(function(driver) {
            return parseInt(driver.dr_ID) === parseInt(driverID);
        });
        if (selectedDriver) {
            displayDriverInfo(selectedDriver);
        } else {
            console.error('드라이버 정보를 찾을 수 없습니다.');
        }
    });
        }
     // 드라이버 정보를 화면에 출력하는 함수
        function displayDriverInfo(driverInfo) {
            $('#driverName').text('이름: ' + driverInfo.m_NAME);
            $('#driverPhone').text('전화번호: ' + driverInfo.m_PHONE);
            $('#driverAdrees').text('주소: ' + driverInfo.dr_ADDRESS);
            $('#driverLocal').text('주 운행지: ' + driverInfo.dr_AREA);
            $('#driverCarnum').text('차량 번호: ' + driverInfo.dr_CARNUM);
            $('#driverId').text(driverInfo.dr_ID);
        }
     //2024-04-26 진행중-------------------------------------------------------------------------
        // 리스트 예시
        
        
        var dataList = [
        	{ date: "2024-04-26", time: "10:00", status: "운행중" },
            { date: "2024-04-27", time: "11:00", status: "대기중" },
            { date: "2024-04-28", time: "12:00", status: "거절" }
        ];
        
        // 테이블에 데이터 추가
        var table = document.getElementById("myTable");

        dataList.forEach(function(data, index) {
          var row = table.insertRow();
          var cell0 = row.insertCell(0); // 순서 번호를 표시하는 열
          var cell1 = row.insertCell(1);
          var cell2 = row.insertCell(2);
          var cell3 = row.insertCell(3);
          
          
          cell0.innerHTML = index + 1; // 1부터 시작하도록 인덱스에 1을 더합니다.
          cell1.innerHTML = data.date;
          cell2.innerHTML = data.time;
          
       // 상태에 따라 원의 색상을 결정합니다.
          var circleClass = "";
          switch(data.status) {
            case "운행중":
              circleClass = "green";
              break;
            case "대기중":
              circleClass = "orange";
              break;
            case "거절":
              circleClass = "red";
              break;
          }
          cell3.innerHTML =  data.status + '<div class="circle ' + circleClass + '"></div>' ;
        });
        
        
      
        
     /* // 현재 날짜와 시간을 저장할 변수 선언
        var currentDateTime = null;
        // yy-MM-dd 형식의 날짜를 저장할 변수 선언
        var currentDate = null;
        // hh:mm:ss 형식의 시간을 저장할 변수 선언
        var currentTime = null;
        var status = null;
        
        var dataList = [];
        // 버튼 클릭 시 현재 날짜와 시간을 저장하는 함수
        function saveCurrentDateTime() {
          // 현재 날짜와 시간을 가져와 변수에 저장
          var now = new Date();
          // 현재 날짜와 시간을 문자열로 변환하여 저장
          currentDateTime = now.toLocaleString();
          console.log("currentDateTime = " + currentDateTime);

          // yy-MM-dd 형식의 날짜를 저장
          currentDate = now.getFullYear().toString().substring(2) + '-' + addZero(now.getMonth() + 1) + '-' + addZero(now.getDate());
          console.log("currentDate = " + currentDate);
          // hh:mm:ss 형식의 시간을 저장
          currentTime = addZero(now.getHours()) + ':' + addZero(now.getMinutes()) + ':' + addZero(now.getSeconds());
          console.log("currentTime = " + currentTime);
          
          status = "운행중";
          dataList.push({ date: currentDate, time: currentTime });
          dataList.push({ status: status})
          alert("현재 날짜와 시간이 저장되었습니다:\n" + currentDateTime + "\n날짜: " + currentDate + "\n시간: " + currentTime);
        }

        // 숫자를 두 자리수로 변환하는 함수
        function addZero(num) {
          return (num < 10 ? '0' : '') + num;
        } */
    </script>
</body>
</html>