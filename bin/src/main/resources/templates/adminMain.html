<html xmlns:th="http://www.thymeleaf.org">
<link
  href="https://getbootstrap.com/docs/5.3/dist/css/bootstrap.min.css"
  rel="stylesheet"
  integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
  crossorigin="anonymous">
<script
  src="https://getbootstrap.com/docs/5.3/dist/js/bootstrap.bundle.min.js"
  integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
  crossorigin="anonymous"></script>
<link
  href="https://getbootstrap.com/docs/5.3/examples/sidebars/sidebars.css"
  rel="stylesheet">
<script src="https://code.jquery.com/jquery-3.7.1.min.js"
  integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo="
  crossorigin="anonymous"></script>
  <script src="js/jquery-3.7.1.min.js"></script>
<link rel="stylesheet" href="css/style.css">
<!-- 부트스트랩 CSS 링크 -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap-datepicker@1.9.0/dist/js/bootstrap-datepicker.min.js"></script>
<link href="https://cdn.jsdelivr.net/npm/bootstrap-datepicker@1.9.0/dist/css/bootstrap-datepicker.min.css" rel="stylesheet">
<!-- Bootstrap Icons CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">


<style>
    #datePickerButton {
        background-color: #3F7EFC;
        border-color: #3F7EFC; /* 선택적으로 테두리 색상을 지정할 수 있습니다. */
    }
</style>

</head>

    <link rel="stylesheet" href="css/style.css">
     <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=9c49835d1348562532a0d8a13f2f7bf3&libraries=clusterer"></script>
    <th:block th:insert="~{fragments :: header}"></th:block>
</head>
<body>
    <!-- 템플릿 본문 내용 -->
   <main class="d-flex flex-nowrap">
  <div class="d-flex flex-column align-items-stretch flex-shrink-0 bg-body-tertiary border border-r-1" style="width: 380px;">
    <div class="d-flex align-items-center flex-shrink-0 p-3 link-body-emphasis text-decoration-none">
      <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="#4ae39c" viewBox="0 0 256 256" class="me-2">
        <path d="M232,128A104,104,0,1,1,128,24,104.13,104.13,0,0,1,232,128Z" fill="#3F7EFC"></path>
      </svg>
      <span class="fs-5 fw-semibold">접수 현황</span>
    </div>
      <div
      class="d-flex flex-wrap py-3 px-2 gap-3 align-items-center justify-content-center border-bottom">
    <div class="border-start border-2 h-50"></div>
      <div class="d-flex flex-column align-items-center">
        <div id="DATE-TIME"> </div>
        <div class="fw-light" style="font-size: 0.8rem">DATE
        <button type="button" class="btn btn-secondary p-0" id="datePickerButton" >
        <i class="bi bi-calendar"></i>
        </button>
        </div>
      </div>
      <div class="border-start border-2 h-50"></div>
      <div class="d-flex flex-column align-items-center">
        <div id="Count">0</div>
        <div class="fw-light" style="font-size: 0.8rem">접수 현황</div>
      </div>
      <div class="border-start border-2 h-50"></div>
    
        
  
        </div>
        <div style="display: flex; justify-content: center; align-items: center; background-color: #3F7EFC;">
        <span class="fs-5 fw-semibold" style="margin-top: 5%; margin-bottom: 5%; color: #4D4D4D;" >M  E  N  U</span>
        </div>
         <a href="driverJoin" class="list-group-item list-group-item-action py-3 lh-sm mt-3 border rounded-2" style="background-color: #f0f8ff;">
        <div class="d-flex w-100 align-items-center justify-content-start mb-1" style="margin-top: 8%; ">
          <span class="badge text-bg-secondary" style=" margin-bottom: 6%; margin-right:25%;">등록</span><strong class="ms-1" style="margin-bottom: 6%;">기사 등록</strong>
          <input type="hidden" value="${node.id}" id="node_id">
        </div>
      </a>
        <a href="mainCenter" class="list-group-item list-group-item-action py-3 lh-sm mt-3 border rounded-2" style="background-color: #f0f8ff;">
        <div class="d-flex w-100 align-items-center justify-content-start mb-1" style="margin-top: 8%">
          <span class="badge text-bg-secondary" style=" margin-bottom: 6%;  margin-right:25%;">배정</span><strong class="ms-1" style=" margin-bottom: 6%;">기사 배정</strong>
          <input type="hidden" value="${node.id}" id="node_id">
        </div>
      </a>
      
         <a href="adminMain" class="list-group-item list-group-item-action py-3 lh-sm mt-3 border rounded-2" style="background-color: #f0f8ff;">
        <div class="d-flex w-100 align-items-center justify-content-start mb-1" style="margin-top: 8%">
          <span class="badge text-bg-secondary" style=" margin-bottom: 6%; margin-right:25%;">접수</span><strong class="ms-1" style=" margin-bottom: 6%;">접수 현황</strong>
          <input type="hidden" value="${node.id}" id="node_id">
        </div>
      </a>
      <a href="(미정)" class="list-group-item list-group-item-action py-3 lh-sm mt-3 border rounded-2" style="background-color: #f0f8ff;">
        <div class="d-flex w-100 align-items-center justify-content-start mb-1" style="margin-top: 8%">
          <span class="badge text-bg-secondary" style=" margin-bottom: 6%; margin-right:18%;">몰라</span><strong class="ms-1" style=" margin-bottom: 6%;">현황 및 특이사항</strong>
          <input type="hidden" value="${node.id}" id="node_id">
        </div>
      </a>
      
      <a href="(미정)" class="list-group-item list-group-item-action py-3 lh-sm mt-3 border rounded-2" style="background-color: #f0f8ff;">
        <div class="d-flex w-100 align-items-center justify-content-start mb-1" style="margin-top: 8%">
          <span class="badge text-bg-secondary" style=" margin-bottom: 6%; margin-right:25%;">문의</span><strong class="ms-1" style=" margin-bottom: 6%;">문의 내역</strong>
          <input type="hidden" value="${node.id}" id="node_id">
        </div>
      </a>
    </div>
    
    
    
    
    
    
    
</div>
    <div id="map" style="width:100%;height:920px;"></div>
</main>
    
<script th:inline="javascript">

var map = new kakao.maps.Map(document.getElementById('map'), {
    center: new kakao.maps.LatLng(37.4845117, 126.694807), // 지도의 중심좌표 
    level: 8 // 지도의 확대 레벨 
});

// 마커를 담을 배열
var markers = [];




//nodeList를 사용하여 마커와 클러스터러를 추가합니다.
var nodeList = /*[[${nodeList}]]*/ null;
//console.log("nodeList = ", nodeList);


// 노드 리스트를 반복하면서 각 노드에 대해 마커를 생성하고 markers 배열에 추가합니다.
for (const node of nodeList) {
   // console.log(node);
    addMarker(node);
}

// 클러스터러를 생성합니다.
var clusterer = new kakao.maps.MarkerClusterer({
    map: map, // 지도 객체
    averageCenter: false, // 클러스터 마커의 중심 위치를 평균화할지 여부
    minLevel: 8 // 클러스터러가 동작할 최소 지도 레벨
});

// 클러스터러에 마커들을 추가합니다.
clusterer.addMarkers(markers);

// 해당하는 노드의 마커를 추가하는 함수
function addMarker(node) {
    var markerPosition = new kakao.maps.LatLng(node.y, node.x); // 해당하는 노드의 위치
    var marker = new kakao.maps.Marker({
        position: markerPosition
    });
    markers.push(marker); // 마커를 markers 배열에 추가합니다.
}

//#Count 업데이트 함수
function updateCount() {
    var count = nodeList.length; // nodeList의 길이가 접수 현황의 개수입니다.
    console.log(nodeList.length);
    document.getElementById('Count').innerText = count; // #Count 업데이트
}


// 페이지가 로드될 때 기본값으로 현재 날짜를 표시하는 함수
function displayCurrentDate() {
    const currentDate = new Date();
    const dateString = currentDate.toLocaleDateString(); // 날짜 포맷을 조정할 수 있음
    document.getElementById('DATE-TIME').innerText = dateString;
}

// 페이지가 로드될 때 부트스트랩 달력 초기화
window.onload = function () {
    $('#datePickerButton').datepicker({
        format: 'yyyy-mm-dd',
        autoclose: true,
        todayHighlight: true
    }).on('changeDate', function (e) {
        const selectedDate = e.format();
        document.getElementById('DATE-TIME').innerText = selectedDate;
    });
    displayCurrentDate();
    updateCount(); // #Count 업데이트
};


</script>
</body>
</html>